window.bp=window.bp||{};(function(bp,$,undefined){var mentionsQueryCache=[],mentionsItem;bp.mentions=bp.mentions||{};bp.mentions.users=window.bp.mentions.users||[];if(typeof window.SZ_Suggestions==="object"){bp.mentions.users=window.SZ_Suggestions.friends||bp.mentions.users}$.fn.sz_mentions=function(options){if($.isArray(options)){options={data:options}}var suggestionsDefaults={delay:200,hideWithoutSuffix:true,insertTpl:"@${ID}",limit:10,startWithSpace:false,suffix:"",callbacks:{filter:function(query,data,search_key){var item,_i,_len,_results=[],regxp=new RegExp("^"+query+"| "+query,"ig");for(_i=0,_len=data.length;_i<_len;_i++){item=data[_i];if(item[search_key].toLowerCase().match(regxp)){_results.push(item)}}return _results},highlighter:function(li,query){if(!query){return li}var regexp=new RegExp(">(\\s*|[\\w\\s]*)("+this.at.replace("+","\\+")+"?"+query.replace("+","\\+")+")([\\w ]*)\\s*<","ig");return li.replace(regexp,function(str,$1,$2,$3){return">"+$1+"<strong>"+$2+"</strong>"+$3+"<"})},before_reposition:function(offset){var caret,line,iframeOffset,move,$view=$("#atwho-ground-"+this.id+" .atwho-view"),$body=$("body"),atwhoDataValue=this.$inputor.data("atwho");if("undefined"!==atwhoDataValue&&"undefined"!==atwhoDataValue.iframe&&null!==atwhoDataValue.iframe){caret=this.$inputor.caret("offset",{iframe:atwhoDataValue.iframe});iframeOffset=$(atwhoDataValue.iframe).offset();if("undefined"!==iframeOffset){caret.left+=iframeOffset.left;caret.top+=iframeOffset.top}}else{caret=this.$inputor.caret("offset")}if(caret.left>$body.width()/2){$view.addClass("right");move=caret.left-offset.left-this.view.$el.width()}else{$view.removeClass("right");move=caret.left-offset.left+1}if($body.width()<=400){$(document).scrollTop(caret.top-6)}line=parseInt(this.$inputor.css("line-height").substr(0,this.$inputor.css("line-height").length-2),10);if(!line||line<5){line=19}offset.top=caret.top+line;offset.left+=move},inserting_wrapper:function($inputor,content,suffix){return""+content+suffix}}},mentionsDefaults={callbacks:{remoteFilter:function(query,render_view){var self=$(this),params={};mentionsItem=mentionsQueryCache[query];if(typeof mentionsItem==="object"){render_view(mentionsItem);return}if(self.xhr){self.xhr.abort()}params={action:"sz_get_suggestions",term:query,type:"members"};if($.isNumeric(this.$inputor.data("suggestions-group-id"))){params["group-id"]=parseInt(this.$inputor.data("suggestions-group-id"),10)}else if($.isNumeric(this.$inputor.data("suggestions-event-id"))){params["event-id"]=parseInt(this.$inputor.data("suggestions-event-id"),10)}self.xhr=$.getJSON(ajaxurl,params).done(function(response){if(!response.success){return}var data=$.map(response.data,function(suggestion){suggestion.search=suggestion.search||suggestion.ID+" "+suggestion.name;return suggestion});mentionsQueryCache[query]=data;render_view(data)})}},data:$.map(options.data,function(suggestion){suggestion.search=suggestion.search||suggestion.ID+" "+suggestion.name;return suggestion}),at:"@",searchKey:"search",displayTpl:'<li data-value="@${ID}"><img src="${image}" /><span class="username">@${ID}</span><small>${name}</small></li>'},opts=$.extend(true,{},suggestionsDefaults,mentionsDefaults,options);return $.fn.atwho.call(this,opts)};$(document).ready(function(){$(".sz-suggestions, #comments form textarea, .wp-editor-area").sz_mentions(bp.mentions.users)});bp.mentions.tinyMCEinit=function(){if(typeof window.tinyMCE==="undefined"||window.tinyMCE.activeEditor===null||typeof window.tinyMCE.activeEditor==="undefined"){return}else{$(window.tinyMCE.activeEditor.contentDocument.activeElement).atwho("setIframe",$(".wp-editor-wrap iframe")[0]).sz_mentions(bp.mentions.users)}}})(bp,jQuery);